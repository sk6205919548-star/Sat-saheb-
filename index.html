<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Social Media Sewa Form - Assam</title>
</head>

<body style="font-family:Arial;padding:15px;text-align:center;">

<h2>Social Media Sewa Form</h2>

<label>‡§®‡§æ‡§Æ / Name</label><br>
<input id="name" style="width:90%;padding:8px;margin:auto;display:block;"><br><br>

<label>District Name</label><br>
<select id="district" onchange="loadTehsil()" style="width:90%;padding:8px;margin:auto;display:block;">
  <option value="">Loading...</option>
</select><br><br>

<label>Tehsil Name</label><br>
<select id="tehsil" onchange="loadSewadar()" style="width:90%;padding:8px;margin:auto;display:block;">
  <option value="">Select Tehsil</option>
</select><br><br>

<label>Sewadar Name</label><br>
<select id="sewadar" style="width:90%;padding:8px;margin:auto;display:block;">
  <option value="">Select Sewadar</option>
</select><br><br>

<label>Sewa Count</label><br>
<input id="sewa" type="number" style="width:90%;padding:8px;margin:auto;display:block;"><br><br>

<button onclick="submitToSheet()" style="padding:10px 20px;font-size:16px;display:block;margin:auto;">
Submit
</button>

<p id="msg"></p>

<!-- ================= SCRIPT START ================= -->
<script>
let DATA = {};
const CACHE_KEY = "DISTRICT_DATA_CACHE";

// üîπ Load from Cache First (Instant)
const cached = localStorage.getItem(CACHE_KEY);
if(cached){
  DATA = JSON.parse(cached);
  loadDistricts();   // ‚ö° instant load
}

// üîπ Fetch Fresh Data (Background Update)
fetch("https://script.google.com/macros/s/AKfycby50_BxdQ0y4fevWc0nmN0nQvfPMRmMheLgF0RJoR-NddCuYydAnQ72iNHuwj3hHLXW/exec")
.then(res => res.json())
.then(json => {
  DATA = json;
  localStorage.setItem(CACHE_KEY, JSON.stringify(json)); // cache save
  loadDistricts(); // refresh with latest data
});

// üîπ Load Districts
function loadDistricts(){
  const districtSelect = document.getElementById("district");
  districtSelect.innerHTML = `<option value="">Select District</option>`;
  for(let d in DATA){
    districtSelect.innerHTML += `<option value="${d}">${d}</option>`;
  }
}

// üîπ Load Tehsil
function loadTehsil(){
  const tehsilSelect = document.getElementById("tehsil");
  const sewadarSelect = document.getElementById("sewadar");

  tehsilSelect.innerHTML = "<option value=''>Select Tehsil</option>";
  sewadarSelect.innerHTML = "<option value=''>Select Sewadar</option>";

  let district = document.getElementById("district").value;
  if(!DATA[district]) return;

  for(let t in DATA[district]){
    tehsilSelect.innerHTML += `<option value="${t}">${t}</option>`;
  }
}

// üîπ Load Sewadar
function loadSewadar(){
  const sewadarSelect = document.getElementById("sewadar");
  sewadarSelect.innerHTML = "<option value=''>Select Sewadar</option>";

  let district = document.getElementById("district").value;
  let tehsil = document.getElementById("tehsil").value;

  if(!DATA[district] || !DATA[district][tehsil]) return;

  DATA[district][tehsil].forEach(s=>{
    sewadarSelect.innerHTML += `<option value="${s}">${s}</option>`;
  });
}

// üîπ Submit to Google Sheet
function submitToSheet(){
  const name = document.getElementById("name").value;
  const district = document.getElementById("district").value;
  const tehsil = document.getElementById("tehsil").value;
  const sewadar = document.getElementById("sewadar").value;
  const sewa = document.getElementById("sewa").value;

  if(!name || !district || !tehsil || !sewadar){
    alert("‚ùå ‡§∏‡§≠‡•Ä ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç");
    return;
  }

  const data = { 
    name, 
    district, 
    tehsil, 
    sewadar, 
    sewa, 
    time: new Date().toLocaleString() 
  };

  document.getElementById("msg").innerText = "Sending...";

  fetch("https://script.google.com/macros/s/AKfycbxFEo-3G1Rug0WW5zXbmOjMhXFfRskrAiuYOJ2cluLiZ0HXF3WkilL1uicOhg6U49Wq/exec", {
    method: "POST",
    mode: "no-cors",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });

  document.getElementById("msg").innerText = `‚úÖ Data Google Sheet me save ho gaya`;
}
</script>
<!-- ================= SCRIPT END ================= -->

</body>
</html>
